<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>One Ai - هوش مصنوعی</title>
  <style>
    body { font-family: Tahoma, sans-serif; direction: rtl; background: #f4f4f4; margin: 0; padding: 0; }
    #chatContainer { max-width: 650px; margin: 20px auto; background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 0 15px #ccc; }
    h1 { text-align: center; color: #0074d9; margin-top: 0; }
    #messages { height: 450px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; background: #fafafa; margin-bottom: 10px; }
    .message { margin: 6px 0; padding: 10px 14px; border-radius: 12px; max-width: 75%; clear: both; line-height: 1.6; word-wrap: break-word; }
    .user { background: #d0e6ff; float: left; }
    .bot { background: #eeeeee; float: right; }
    input[type=text] { width: calc(100% - 24px); padding: 10px; font-size: 15px; border-radius: 8px; border: 1px solid #ccc; }
    button { margin-top: 10px; width: 100%; padding: 10px; background: #0074d9; color: white; font-size: 15px; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #005fa3; }
    #footer { text-align: center; margin-top: 20px; color: gray; font-size: 14px; }
  </style>
</head>
<body>
<div id="chatContainer">
  <h1>🤖 One Ai (V0.0.6)</h1>
  <div id="messages"></div>
  <input type="text" id="userInput" placeholder="هرچی دوست داری بنویس..." onkeydown="if(event.key==='Enter') sendMessage();" />
  <button onclick="sendMessage()">ارسال</button>
  <div id="footer">ساخته شده توسط Rob Lucci</div>
</div>
<script>
  const messages = document.getElementById('messages');
  const userInput = document.getElementById('userInput');
  let lastBotQuestion = null;

  const fallbackReplies = [
    "متوجه نشدم کامل، ولی حرفتو دوست داشتم 😅",
    "می‌تونی یه ذره واضح‌تر بگی؟ 👀",
    "شاید سوال سختی بود ولی جالبه!",
    "دارم سعی می‌کنم بفهمم، دوباره بگو لطفاً ✨"
  ];

  const yesWords = ['آره','بله','yes','حتما','اوکی','باشه'];
  const noWords = ['نه','خیر','نه بابا','اصلاً','no'];

  const dictionary = [
    { keywords: ['سلام','درود','صبح بخیر','عصر بخیر'], answer: 'سلام رفیق! حالت چطوره؟ 🌞' },
    { keywords: ['خوبی','چطوری','حالت','احوال'], answer: 'من عالی‌ام! تو چطوری؟ 😄' },
    { keywords: ['ربات','تو کی هستی','اسم','one ai'], answer: 'من One Ai هستم، رفیق دیجیتالی تو 🤖' },
    { keywords: ['عشق','دوست داشتن','عاشق','احساس'], answer: 'عشق چیزیه که هم قشنگه، هم درد داره... تو چی فکر می‌کنی؟ ❤️' },
    { keywords: ['غم','افسرده','ناراحتم','حالم بده'], answer: 'بیا یه دل سیر حرف بزنیم تا حالت بهتر شه 😔' },
    { keywords: ['بازی','گیم','سرگرمی'], answer: 'بازی خوب سراغ داری؟ من که Happy Coin رو پیشنهاد می‌کنم 🎮' },
    { keywords: ['فیلم','سریال','انیمه'], answer: 'ژانر مورد علاقت چیه؟ من که عاشق وان پیسم! 🎬' },
    { keywords: ['کتاب','مطالعه','کتابخونی'], answer: 'کتاب خوندی؟ موضوعش چی بود؟ 📚' },
    { keywords: ['برنامه نویسی','کد','کدنویسی'], answer: 'کدنویسی یه دنیای بی‌نهایته! بزن بریم بسازیم 😎' },
    { keywords: ['دیسکورد','چت','پیام','سرور'], answer: 'دیسکورد خیلی باحاله! تو چه سرورایی فعالی؟ 💬' },
    { keywords: ['تیک تاک','اینستا','شبکه اجتماعی'], answer: 'چه محتوایی می‌سازی یا دنبال می‌کنی؟ 📱' },
    { keywords: ['پول','درآمد','شغل','کار'], answer: 'راه‌های درآمد زیادی هست، تو چی مد نظرته؟ 💼' },
    { keywords: ['درس','مدرسه','امتحان','تحصیل'], answer: 'درسات چطور پیش میره؟ کمک خواستی من هستم 📘' },
    { keywords: ['هدف','برنامه','آینده','رویا'], answer: 'برنامه‌ت برای آینده چیه؟' },
    { keywords: ['ورزش','تمرین','سلامتی','بدن'], answer: 'سلامتیت مهمه! چه ورزشی می‌کنی؟ 💪' },
    { keywords: ['خسته','خواب','استراحت'], answer: 'یه چرت کوچولو بزن، ریکاوری میشی 😴' },
    { keywords: ['جوک','خنده','بخندونم'], answer: 'جوک: چرا برنامه‌نویسا گربه نگه نمی‌دارن؟ چون mouse دارن! 😂' },
    { keywords: ['خداحافظ','بای','فعلا'], answer: 'فعلاً رفیق، منتظرم برگردی! 🖐️' },
    { keywords: ['سفر','گردش','طبیعت','مسافرت'], answer: 'کجا دوست داری سفر بری؟ 🌍' },
    { keywords: ['غذا','رستوران','خوراکی','آشپزی'], answer: 'غذای مورد علاقت چیه؟ من که پیتزا 😋' },
    { keywords: ['هوش مصنوعی','AI','ربات','ماشین'], answer: 'هوش مصنوعی آینده رو می‌سازه، می‌خوای باهاش بسازی؟ 🤖' }
  ];

  function levenshtein(a, b) {
    const matrix = [];
    for (let i = 0; i <= b.length; i++) matrix[i] = [i];
    for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
    for (let i = 1; i <= b.length; i++) {
      for (let j = 1; j <= a.length; j++) {
        matrix[i][j] = Math.min(
          matrix[i - 1][j] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j - 1] + (b[i - 1] === a[j - 1] ? 0 : 1)
        );
      }
    }
    return matrix[b.length][a.length];
  }

  function findBestMatch(text) {
    let bestItem = null, bestScore = Infinity;
    const words = text.split(/\s+/);
    for (let item of dictionary) {
      for (let kw of item.keywords) {
        for (let w of words) {
          const dist = levenshtein(w.toLowerCase(), kw.toLowerCase());
          if (dist < bestScore) {
            bestScore = dist;
            bestItem = item;
          }
        }
      }
    }
    return bestScore <= 2 ? bestItem : null;
  }

  function extractQuestions(text) {
    const sentences = text.split(/[.؟!?]/).map(s => s.trim()).filter(Boolean);
    const qWords = ['چی','چرا','چطور','کجا','چه','چند','آیا','کی','چگونه'];
    return sentences.filter(s => qWords.some(w => s.startsWith(w) || s.includes(' ' + w)));
  }

  function isAnswerToLastQuestion(text) {
    const isQuestion = /[؟?]/.test(text);
    const hasVerb = /(کردم|دیدم|خریدم|رفتم|خوندم|یادمه|آوردم|دارم|زدم|می‌خوام|سازم|می‌سازم)/i.test(text);
    return lastBotQuestion && !isQuestion && hasVerb;
  }

  function handleYesNo(text) {
    const lower = text.toLowerCase();
    if (lastBotQuestion) {
      if (yesWords.includes(lower)) return 'عالیه! بریم ادامه بدیم 😊';
      if (noWords.includes(lower)) return 'باشه، موضوع رو عوض کنیم؟';
    }
    return null;
  }

  function addMessage(text, sender) {
    const msg = document.createElement('div');
    msg.classList.add('message', sender);
    msg.textContent = text;
    messages.appendChild(msg);
    messages.scrollTop = messages.scrollHeight;
  }

  function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;
    addMessage(text, 'user');
    userInput.value = '';

    setTimeout(() => {
      let response = null;

      if (isAnswerToLastQuestion(text)) {
        response = 'اوه فهمیدم! خیلی جالب بود 🙌';
        lastBotQuestion = null;
      }

      if (!response) {
        const questions = extractQuestions(text);
        for (const q of questions) {
          const found = dictionary.find(item => item.keywords.some(kw => q.includes(kw))) || findBestMatch(q);
          if (found) {
            response = found.answer;
            lastBotQuestion = /[؟?]$/.test(response) ? response : null;
            break;
          }
        }
      }

      if (!response) {
        const yn = handleYesNo(text);
        if (yn) {
          response = yn;
          lastBotQuestion = null;
        }
      }

      if (!response) {
        const found = dictionary.find(item => item.keywords.some(kw => text.includes(kw))) || findBestMatch(text);
        if (found) {
          response = found.answer;
          lastBotQuestion = /[؟?]$/.test(response) ? response : null;
        }
      }

      if (!response) {
        response = fallbackReplies[Math.floor(Math.random() * fallbackReplies.length)];
        lastBotQuestion = null;
      }

      addMessage(response, 'bot');
    }, 600);
  }
</script>
</body>
</html>
